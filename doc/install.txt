Setting up HereNow
++++++++++++++++++

Ubuntu Dependencies
===================

::

    sudo apt-get install build-essential tcpdump

Node.js
=======

First of all you need node 0.1.98 from here:

::

    wget http://nodejs.org/dist/node-v0.1.98.tar.gz

There are some optional libraries you might need for things like SSL. I'll list
them here if I ever need them.

Install like this:

::

    tar zxfv node-v0.1.98.tar.gz
    cd node-v0.1.98
    ./configure --prefix=/home/james/Work/HereNow/usr
    make
    make install


Now every time you start working with node you can just run this to get things going

Node looks for libraries in the places given by the ``require.paths`` variable. Here's a test to see where they are for you. It is in ``tests/paths.js``:

::

    var sys = require("sys");
    sys.puts(require.paths);

Run it like this:

::

    /home/james/Work/HereNow/usr/bin/node tests/paths.js

The output for me looks like this:

    /home/james/.node_libraries,/home/james/Desktop/Work/HereNow/usr/lib/node

As you can see the default is the directory where node's libraries are and a
special directory called ``~/.node_libraries``. You can also add extra
directories by setting the ``NODE_PATH`` environment variable.

Naming Conventions
------------------

Node follows the CommonJS module specs so when ``require('assert')`` is called
Node looks for:

* 1: ~/.node_libraries/assert.js
* 2: ~/.node_libraries/assert.node
* 3: ~/.node_libraries/assert/index.js
* 4: ~/.node_libraries/assert/index.node

More here: http://nodejs.org/api.html#modules-288

Mongo DB
========

The Node MongoDB drivers only work with the 1.4.x branch of Mongo, not the development branch.

Get the latest 1.4.x version for your platform from here:

http://www.mongodb.org/display/DOCS/Downloads

Then unzip it and merge the contents into the directories in ``/home/james/Work/HereNow/usr`` created by node.

You'll need a running MongoDB 1.4.3 instance with a ``test`` database and a
``foo`` collection with a document with an ``a`` attribute.
Create a directory for mongo:

::

    mkdir ../data

Start mongo like this:

::

    mongod --dbpath ../data

HereNow Source
==============

Install like this:

::

    git clone git@github.com:chris-d-adams/HereNow.git
    mv HereNow code
    cd code
    git submodule init
    git submodule update
    cd lib/mongoose/lib/support/mongodb
    ln -s ../../../../node-mongodb-native/lib lib
    cd ../../../../../

Bash Paths
----------

Before you can run the app you need to set up some environment variables so that bash can find Node and Node can find the herenow dependencies.

Create a bash script to set up your paths. I call mine ``paths.sh`` and it has this content:

::

    export PATH=$PATH:/home/james/Desktop/Work/HereNow/usr/bin
    export NODE_PATH=$NODE_PATH:/home/james/Desktop/Work/HereNow/code/lib

Every time you open a new terminal you'll need to source this file to set up the paths. You can do so like this:

::

    . paths.sh

Running the App Server
----------------------

Run the app server like this:

::

    node server.js

Make sure mongo is running first though or you'll see this error:

::

    Server running at http://127.0.0.1:8001/ 
    
    
    events:11
            throw arguments[1];
                           ^
    Error: ECONNREFUSED, Connection refused  
        at IOWatcher.callback (net:873:22)   
        at node.js:221:9


Running the network traffic monitor
-----------------------------------

::

    node tests/tcpdump.js

You'll be prompted for your password.


